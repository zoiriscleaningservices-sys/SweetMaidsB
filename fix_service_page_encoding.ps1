$files = Get-ChildItem -Filter *.html -Recurse

# The "Monster" corruption for Ellipsis found in house-cleaning.html
# Bytes: C3 83 C6 92 C3 86 E2 80 99 C3 83 E2 80 9A C3 82 C2 A2 C3 83 C6 92 C3 82 C2 A2 C3 83 C2 A2 C3 A2 E2 80 9A C2 AC C3 85 C2 A1 C3 83 E2 80 9A C3 82 C2 AC C3 83 C6 92 C3 82 C2 A2 2D C5 A1 C3 82 C2 AC C3 83 E2 80 9A C3 82 C2 9D
$badBytes = @(0xC3, 0x83, 0xC6, 0x92, 0xC3, 0x86, 0xE2, 0x80, 0x99, 0xC3, 0x83, 0xE2, 0x80, 0x9A, 0xC3, 0x82, 0xC2, 0xA2, 0xC3, 0x83, 0xC6, 0x92, 0xC3, 0x82, 0xC2, 0xA2, 0xC3, 0x83, 0xC2, 0xA2, 0xC3, 0xA2, 0xE2, 0x80, 0x9A, 0xC2, 0xAC, 0xC3, 0x85, 0xC2, 0xA1, 0xC3, 0x83, 0xE2, 0x80, 0x9A, 0xC3, 0x82, 0xC2, 0xAC, 0xC3, 0x83, 0xC6, 0x92, 0xC3, 0x82, 0xC2, 0xA2, 0x2D, 0xC5, 0xA1, 0xC3, 0x82, 0xC2, 0xAC, 0xC3, 0x83, 0xE2, 0x80, 0x9A, 0xC3, 0x82, 0xC2, 0x9D)

$badString = [System.Text.Encoding]::UTF8.GetString($badBytes)
$replacement = "..."

foreach ($file in $files) {
    # Read as text first to check existence (fast)
    $content = [System.IO.File]::ReadAllText($file.FullName)
    
    if ($content.Contains($badString)) {
        Write-Host "Fixing $($file.Name)..."
        $newContent = $content.Replace($badString, $replacement)
        [System.IO.File]::WriteAllText($file.FullName, $newContent, [System.Text.Encoding]::UTF8)
    }
}
